<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penjadwalan Waktu Luang</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .month-selector {
            margin: 15px 0;
        }
        .month-selector select {
            padding: 6px;
            border-radius: 4px;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        select, input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #addBtn {
            background-color: #4CAF50;
            color: white;
            margin-bottom: 20px;
        }
        .remove-btn {
            background-color: #ff4444;
            color: white;
        }
        #output {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .copy-btn {
            background-color: #2196F3;
            color: white;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Jadwal Waktu Luang Mengajar</h1>
        
        <div class="month-selector">
            <label for="monthSelect">Bulan:</label>
            <select id="monthSelect" onchange="updateDateDropdowns()"></select>
        </div>
        <div id="inputContainer">
            <div class="input-group">
                <select class="date-select"></select>
                <input type="time" required>
                <input type="time" required>
                <button type="button" class="remove-btn" onclick="removeInputGroup(this)">-</button>
            </div>
        </div>
        
        <button type="button" id="addBtn" onclick="addInputGroup()">+ Tambah Sesi</button>
        <button type="button" onclick="generateSchedule()">Buat Jadwal</button>
        
        <div id="output"></div>
    </div>
    <script>
        const monthNames = [
            "Januari", "Februari", "Maret", "April", "Mei", "Juni",
            "Juli", "Agustus", "September", "Oktober", "November", "Desember"
        ];
        
        function getDaysInMonth(month, year) {
            // Month is 1-indexed in the select but 0-indexed for Date
            return new Date(year, month, 0).getDate();
        }
        
        function updateDateDropdowns() {
            const monthSelect = document.getElementById('monthSelect');
            const selectedMonth = parseInt(monthSelect.value);
            const currentYear = new Date().getFullYear();
            const daysInMonth = getDaysInMonth(selectedMonth, currentYear);
            
            // Update all date dropdowns
            const dateSelects = document.querySelectorAll('.date-select');
            dateSelects.forEach(select => {
                const selectedValue = select.value; // Store current selection
                select.innerHTML = ''; // Clear options
                
                // Populate options
                for (let i = 1; i <= daysInMonth; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option);
                }
                
                // Restore selection if valid, otherwise set to 1
                if (selectedValue && parseInt(selectedValue) <= daysInMonth) {
                    select.value = selectedValue;
                } else {
                    select.value = 1;
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const monthSelect = document.getElementById('monthSelect');
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1;
            const currentDay = currentDate.getDate();
            
            // Populate month dropdown
            monthNames.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                if (index + 1 === currentMonth) {
                    option.selected = true;
                }
                monthSelect.appendChild(option);
            });
            
            // Initialize date dropdowns
            updateDateDropdowns();
            
            // Set current date as default for the first input
            const dateSelect = document.querySelector('.date-select');
            if (dateSelect) {
                dateSelect.value = currentDay;
            }
        });
        
        function addInputGroup() {
            const group = document.createElement('div');
            group.className = 'input-group';
            
            // Create date dropdown
            const dateSelect = document.createElement('select');
            dateSelect.className = 'date-select';
            
            // Create time inputs
            const startTimeInput = document.createElement('input');
            startTimeInput.type = 'time';
            startTimeInput.required = true;
            
            const endTimeInput = document.createElement('input');
            endTimeInput.type = 'time';
            endTimeInput.required = true;
            
            // Create remove button
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = '-';
            removeBtn.onclick = function() { removeInputGroup(this); };
            
            // Add elements to group
            group.appendChild(dateSelect);
            group.appendChild(startTimeInput);
            group.appendChild(endTimeInput);
            group.appendChild(removeBtn);
            
            // Add group to container
            document.getElementById('inputContainer').appendChild(group);
            
            // Populate the new date dropdown
            const monthSelect = document.getElementById('monthSelect');
            const selectedMonth = parseInt(monthSelect.value);
            const currentYear = new Date().getFullYear();
            const daysInMonth = getDaysInMonth(selectedMonth, currentYear);
            
            for (let i = 1; i <= daysInMonth; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                dateSelect.appendChild(option);
            }
        }
        
        function removeInputGroup(btn) {
            btn.parentElement.remove();
        }
        
        function deteksiHari(day, month, year) {
            if (month < 3) {
                month += 12;
                year--;
            }
            const k = year % 100;
            const j = Math.floor(year / 100);
            const h = (day + Math.floor((13 * (month + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) + 5 * j) % 7;
            const days = ["Sabtu", "Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat"];
            return days[(h + 7) % 7];
        }
        
        function generateSchedule() {
            const now = new Date();
            const selectedMonth = parseInt(document.getElementById('monthSelect').value);
            const currentYear = now.getFullYear();
            const inputs = document.querySelectorAll('.input-group');
            let outputHTML = `<div id="scheduleContent"><p>Saya tersedia waktu luang untuk diisi kegiatan mengajar pembelajaran kursus les pada:</p>`;
            
            inputs.forEach(group => {
                const day = parseInt(group.querySelector('.date-select').value);
                const startTime = group.children[1].value.replace(':', '.');
                const endTime = group.children[2].value.replace(':', '.');
                const timeRange = `${startTime}-${endTime}`;
                
                const hari = deteksiHari(day, selectedMonth, currentYear);
                outputHTML += `
                    <p>
                        Hari ${hari}, 
                        Tanggal: ${day} ${monthNames[selectedMonth - 1]} ${currentYear},<br>
                        Pukul: ${timeRange} WIB
                    </p>
                `;
            });
            
            outputHTML += `<p>Silahkan kabari saya semisal murid berminat les dan kira-kira jam berapa persisnya</p></div>`;
            outputHTML += `<button class="copy-btn" onclick="copySchedule()">Salin ke Clipboard</button>`;
            document.getElementById('output').innerHTML = outputHTML;
        }
        
        function copySchedule() {
            const scheduleContent = document.getElementById('scheduleContent');
            if (scheduleContent) {
                const text = scheduleContent.innerText;
                navigator.clipboard.writeText(text)
                    .then(() => alert('Jadwal berhasil disalin!'))
                    .catch(err => alert('Gagal menyalin: ' + err));
            } else {
                alert('Tidak ada jadwal untuk disalin.');
            }
        }
    </script>
</body>
</html>