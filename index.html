<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penjadwalan Waktu Luang</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    select, input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      flex: 1;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #addBtn {
      background-color: #4CAF50;
      color: white;
      margin-bottom: 20px;
    }
    .remove-btn {
      background-color: #ff4444;
      color: white;
    }
    #output {
      margin-top: 20px;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 4px;
    }
    .copy-btn {
      background-color: #2196F3;
      color: white;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Jadwal Waktu Luang Mengajar</h1>
    
    <!-- Setiap input group memiliki dropdown bulan dan tanggal -->
    <div id="inputContainer">
      <div class="input-group">
        <select class="month-select"></select>
        <select class="date-select"></select>
        <input type="time" required>
        <input type="time" required>
        <button type="button" class="remove-btn" onclick="removeInputGroup(this)">-</button>
      </div>
    </div>
    
    <button type="button" id="addBtn" onclick="addInputGroup()">+ Tambah Sesi</button>
    <button type="button" onclick="generateSchedule()">Buat Jadwal</button>
    
    <div id="output"></div>
  </div>
  
  <script>
    const monthNames = [
      "Januari", "Februari", "Maret", "April", "Mei", "Juni",
      "Juli", "Agustus", "September", "Oktober", "November", "Desember"
    ];
    
    // Menghitung jumlah hari dalam bulan tertentu dengan memperhitungkan tahun
    function getDaysInMonth(month, year) {
      return new Date(year, month, 0).getDate();
    }
    
    // Fungsi untuk memperbarui opsi tanggal pada suatu input group
    function updateDayOptions(group) {
      const monthSelect = group.querySelector('.month-select');
      const daySelect = group.querySelector('.date-select');
      const selectedMonth = parseInt(monthSelect.value);
      
      // Tentukan tahun berdasarkan pilihan bulan dan current month
      const now = new Date();
      const currentMonth = now.getMonth() + 1;
      const currentYear = now.getFullYear();
      // Jika selectedMonth kurang dari currentMonth, artinya opsi next month (atau roll over tahun)
      const yearForSelected = (selectedMonth < currentMonth) ? currentYear + 1 : currentYear;
      
      const daysInMonth = getDaysInMonth(selectedMonth, yearForSelected);
      
      // Simpan nilai tanggal sebelumnya jika ada
      const previousDay = daySelect.value;
      daySelect.innerHTML = '';
      for (let i = 1; i <= daysInMonth; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        daySelect.appendChild(option);
      }
      
      if (previousDay && previousDay <= daysInMonth) {
        daySelect.value = previousDay;
      } else {
        daySelect.value = 1;
      }
    }
    
    // Fungsi untuk mengisi dropdown bulan dengan dua opsi: current month dan next month
    function populateMonthSelect(selectElement, defaultMonth) {
      selectElement.innerHTML = '';
      const now = new Date();
      const curMonth = now.getMonth() + 1;
      if (!defaultMonth) defaultMonth = curMonth;
      const nextMonth = (curMonth === 12) ? 1 : curMonth + 1;
      
      const option1 = document.createElement('option');
      option1.value = curMonth;
      option1.textContent = monthNames[curMonth - 1];
      if (defaultMonth === curMonth) option1.selected = true;
      selectElement.appendChild(option1);
      
      const option2 = document.createElement('option');
      option2.value = nextMonth;
      option2.textContent = monthNames[nextMonth - 1];
      if (defaultMonth === nextMonth) option2.selected = true;
      selectElement.appendChild(option2);
    }
    
    // Inisialisasi input group pertama saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
      const now = new Date();
      const curMonth = now.getMonth() + 1;
      const curDay = now.getDate();
      
      const initialGroup = document.querySelector('.input-group');
      const monthSelect = initialGroup.querySelector('.month-select');
      const daySelect = initialGroup.querySelector('.date-select');
      populateMonthSelect(monthSelect, curMonth);
      updateDayOptions(initialGroup);
      // Karena default adalah current month, set tanggal ke current day
      daySelect.value = curDay;
      
      // Event: ketika user mengubah pilihan bulan pada group pertama
      monthSelect.addEventListener('change', function() {
        updateDayOptions(initialGroup);
        const now = new Date();
        const curMonth = now.getMonth() + 1;
        if (parseInt(this.value) !== curMonth) {
          daySelect.value = 1;
          daySelect.focus();
        }
      });
      
      // Event: ketika user memilih tanggal, fokus pindah ke input waktu (start time)
      daySelect.addEventListener('change', function() {
        initialGroup.querySelector('input[type="time"]').focus();
      });
      
      daySelect.focus();
    });
    
    // Menambahkan input group baru dengan perhitungan default date yang mempertimbangkan jumlah sesi per hari
    function addInputGroup() {
      const container = document.getElementById('inputContainer');
      const now = new Date();
      const currentMonth = now.getMonth() + 1;
      const currentYear = now.getFullYear();
      const currentDay = now.getDate();
      
      let defaultMonth, defaultDay, defaultYear;
      
      const groups = container.querySelectorAll('.input-group');
      if (groups.length === 0) {
        // Jika belum ada input, gunakan current date
        defaultMonth = currentMonth;
        defaultDay = currentDay;
        defaultYear = currentYear;
      } else {
        // Ambil data dari input group terakhir
        const lastGroup = groups[groups.length - 1];
        const lastMonth = parseInt(lastGroup.querySelector('.month-select').value);
        const lastDay = parseInt(lastGroup.querySelector('.date-select').value);
        // Tentukan tahun untuk lastGroup
        let lastYear = (lastMonth < currentMonth) ? currentYear + 1 : currentYear;
        
        // Hitung berapa banyak input group yang sudah memiliki kombinasi (lastMonth, lastDay, lastYear)
        let count = 0;
        groups.forEach(group => {
          const m = parseInt(group.querySelector('.month-select').value);
          const d = parseInt(group.querySelector('.date-select').value);
          let groupYear = (m < currentMonth) ? currentYear + 1 : currentYear;
          if (m === lastMonth && d === lastDay && groupYear === lastYear) {
            count++;
          }
        });
        
        if (count >= 2) {
          // Jika sudah ada dua sesi pada hari yang sama, default menjadi hari berikutnya.
          // Tentukan jumlah hari di bulan lastMonth
          const daysInMonth = getDaysInMonth(lastMonth, lastYear);
          if (lastDay >= daysInMonth) {
            // Jika sudah di akhir bulan, maka tanggal default menjadi 1 dan bulan berubah ke next month.
            defaultDay = 1;
            defaultMonth = (lastMonth === 12) ? 1 : lastMonth + 1;
            defaultYear = (lastMonth === 12) ? lastYear + 1 : lastYear;
          } else {
            // Jika belum akhir bulan, default hari berikutnya
            defaultDay = lastDay + 1;
            defaultMonth = lastMonth;
            defaultYear = lastYear;
          }
        } else {
          // Jika belum mencapai dua sesi pada hari yang sama, default tetap sama dengan input terakhir
          defaultMonth = lastMonth;
          defaultDay = lastDay;
          defaultYear = lastYear;
        }
      }
      
      // Buat input group baru
      const group = document.createElement('div');
      group.className = 'input-group';
      
      const monthSelect = document.createElement('select');
      monthSelect.className = 'month-select';
      populateMonthSelect(monthSelect, defaultMonth);
      
      const daySelect = document.createElement('select');
      daySelect.className = 'date-select';
      
      const startTimeInput = document.createElement('input');
      startTimeInput.type = 'time';
      startTimeInput.required = true;
      
      const endTimeInput = document.createElement('input');
      endTimeInput.type = 'time';
      endTimeInput.required = true;
      
      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '-';
      removeBtn.onclick = function() { removeInputGroup(this); };
      
      group.appendChild(monthSelect);
      group.appendChild(daySelect);
      group.appendChild(startTimeInput);
      group.appendChild(endTimeInput);
      group.appendChild(removeBtn);
      
      container.appendChild(group);
      
      updateDayOptions(group);
      // Set nilai default tanggal sesuai perhitungan
      daySelect.value = defaultDay;
      
      // Event: ketika user mengganti bulan pada input group baru
      monthSelect.addEventListener('change', function() {
        updateDayOptions(group);
        const now = new Date();
        const curMonth = now.getMonth() + 1;
        if (parseInt(this.value) !== curMonth) {
          daySelect.value = 1;
          daySelect.focus();
        }
      });
      
      // Event: ketika user memilih tanggal, fokus pindah ke input waktu (start time)
      daySelect.addEventListener('change', function() {
        group.querySelector('input[type="time"]').focus();
      });
      
      // Fokus ke dropdown tanggal untuk input group baru
      daySelect.focus();
    }
    
    // Menghapus input group
    function removeInputGroup(btn) {
      btn.parentElement.remove();
    }
    
    // Fungsi algoritma Zeller untuk mendeteksi nama hari
    function deteksiHari(day, month, year) {
      if (month < 3) {
        month += 12;
        year--;
      }
      const k = year % 100;
      const j = Math.floor(year / 100);
      const h = (day + Math.floor((13 * (month + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) + 5 * j) % 7;
      const days = ["Sabtu", "Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat"];
      return days[(h + 7) % 7];
    }
    
    // Menghasilkan jadwal dari seluruh input group dan otomatis menyalin ke clipboard
    function generateSchedule() {
      const now = new Date();
      const curMonth = now.getMonth() + 1;
      const currentYear = now.getFullYear();
      const inputs = document.querySelectorAll('.input-group');
      let outputHTML = `<div id="scheduleContent"><p>Saya tersedia waktu luang untuk diisi kegiatan mengajar pembelajaran kursus les pada:</p>`;
      
      inputs.forEach(group => {
        const month = parseInt(group.querySelector('.month-select').value);
        const day = parseInt(group.querySelector('.date-select').value);
        // Tentukan tahun untuk setiap sesi berdasarkan pilihan bulan
        const scheduleYear = (month < curMonth) ? currentYear + 1 : currentYear;
        const startTime = group.children[2].value.replace(':', '.');
        const endTime = group.children[3].value.replace(':', '.');
        const timeRange = `${startTime}-${endTime}`;
        
        const hari = deteksiHari(day, month, scheduleYear);
        outputHTML += `
          <p>
            Hari ${hari}, 
            Tanggal: ${day} ${monthNames[month - 1]} ${scheduleYear},<br>
            Pukul: ${timeRange} WIB
          </p>
        `;
      });
      
      outputHTML += `<p>Silahkan kabari saya semisal murid berminat les dan kira-kira jam berapa persisnya</p></div>`;
      outputHTML += `<button class="copy-btn" onclick="copySchedule()">Salin ke Clipboard</button>`;
      document.getElementById('output').innerHTML = outputHTML;
      
      // Otomatis menyalin jadwal ke clipboard setelah membuat jadwal
      copySchedule();
    }
    
    // Menyalin jadwal ke clipboard
    function copySchedule() {
      const scheduleContent = document.getElementById('scheduleContent');
      if (scheduleContent) {
        const text = scheduleContent.innerText;
        navigator.clipboard.writeText(text)
          .then(() => alert('Jadwal berhasil disalin!'))
          .catch(err => alert('Gagal menyalin: ' + err));
      } else {
        alert('Tidak ada jadwal untuk disalin.');
      }
    }
  </script>
</body>
</html>
